app-id: org.lhowon.alephone.marathon3
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: run.sh
modules:
  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app --with-libraries=filesystem,system
      - ./b2 install
    sources:
      - sha256: 475d589d51a7f8b3ba2ba4eda022b170e562ca3b760ee922c146b6c65856ef39
        type: archive
        url: https://boostorg.jfrog.io/artifactory/main/release/1.79.0/source/boost_1_79_0.tar.bz2
    cleanup: [/include, /lib/*.a, /lib/debug, /lib/cmake]
  - name: glu
    buildsystem: autotools
    config-opts: [--disable-static]
    sources:
      - type: archive
        url: https://archive.mesa3d.org//glu/glu-9.0.2.tar.xz
        sha256: 6e7280ff585c6a1d9dfcdf2fca489251634b3377bfc33c29e4002466a38d02d4
    cleanup: [/include, /lib/*.la, /lib/debug, /lib/pkgconfig]
  - name: alephone
    buildsystem: autotools
    config-opts: [--with-boost-libdir=/app/lib]
    sources:
      - type: archive
        url: https://github.com/Aleph-One-Marathon/alephone/releases/download/release-20220115/AlephOne-20220115.tar.bz2
        sha256: ca0f5e94c4493a49522fccbbbe512831ed21f88d08bc93b4e365509ca057c2ce
    # TODO is there any point including icons/man/mime when it's not a standalone engine build?
    cleanup: [/lib/debug, /share/icons, /share/man, /share/mime]
  - name: game-data
    buildsystem: simple
    build-commands:
      - cp -r . /app/game-data
    sources:
      - type: git
        url: https://github.com/Aleph-One-Marathon/data-marathon-infinity
  - name: app-data
    buildsystem: simple
    build-commands:
      - install -D run.sh /app/bin/run.sh
      - install -D app.desktop /app/share/applications/org.lhowon.alephone.marathon3.desktop
      - install -D icon.png /app/share/icons/hicolor/512x512/apps/org.lhowon.alephone.marathon3.png
    sources:
      - {type: file, path: run.sh}
      - {type: file, path: app.desktop}
      - {type: file, path: icon.png}
finish-args:
  - --device=dri
  - --socket=x11
  - --socket=pulseaudio
  - --share=network
  - --filesystem=~/.alephone
